# Äá»‹nh nghÄ©a biáº¿n
TOP_MODULE = alu
SRC_DIR = ./../../00_src
SRC_FILES = flist.f
VCD_FILE = $(TOP_MODULE)_wave.vcd
FST_FILE = $(TOP_MODULE)_wave.fst
DUMP_VCD = +dumpfile=$(VCD_FILE)

# Má»¥c tiÃªu chÃ­nh
all: clean test compile run view

# Kiá»ƒm tra cÃº phÃ¡p (khÃ´ng biÃªn dá»‹ch)
test:
	@echo "ğŸ” Kiá»ƒm tra cÃº phÃ¡p vá»›i Verilator..."
	@verilator --lint-only -f $(SRC_FILES)

# BiÃªn dá»‹ch vá»›i Verilator
compile:
	@echo "ğŸš€ BiÃªn dá»‹ch vá»›i Verilator..."
	@verilator --binary --build --trace-fst --timing $(TOP_MODULE)_tb.sv -f $(SRC_FILES) -o sim

# Cháº¡y mÃ´ phá»ng vÃ  táº¡o file VCD
run:
	@echo "ğŸ¬ Cháº¡y mÃ´ phá»ng..."
	@./sim $(DUMP_VCD)

# Táº¡o file VCD/FST khi cháº¡y mÃ´ phá»ng
sim:
	@echo "ğŸ“¡ Cháº¡y mÃ´ phá»ng vá»›i file dump..."
	@./sim $(DUMP_VCD) > verilator.log

# Dá»n dáº¹p file biÃªn dá»‹ch
clean:
	@echo "ğŸ§¹ Dá»n dáº¹p thÆ° má»¥c..."
	@rm -rf obj_dir sim verilator.log $(VCD_FILE) $(FST_FILE)

# Xem waveform báº±ng GTKWave
view:
	@echo "ğŸ‘€ Má»Ÿ GTKWave..."
	gtkwave $(VCD_FILE) &
